@model DCAS_PracticalExam.Models.CPRAssessmentEvaluationFields

@{
    ViewData["Title"] = "AddCPRAssessment";
}


<form method="post" enctype="multipart/form-data">
    <div class="mycontainer p-2">
        <h2 class="text-center" style="color: #c00000">
            Evaluation Form for CPR Assessment
        </h2>
        <h4 class="text-center" style="color: #002060">
            Ambulance Regulation Services Section
        </h4>
        <div>
            <hr />
        </div>
        
        <div class="form-row">
            @* <div class="col-md-6">
              <div class="form-group"> <label asp-for="CandidateName">Candidate Name</label> 
                <input runat="server" id="CandidateName" tabindex="1" name="CandidateName" asp-for="CandidateName" class="form-control" type="text" />
                <span asp-validation-for="CandidateName" class="text-danger"></span>
                  </div>
            </div> *@
            <div class="col-md-6">
                <div class="form-group">
                    <label asp-for="CRMRequest">CRM Request</label>
                    <input asp-for="CRMRequest" runat="server" type="text" value="" tabindex="1" class="form-control" id="crmRequestInput" />
                    <span asp-validation-for="CRMRequest" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-6">
            <div class="form-group"> <label asp-for="TestDate">Test Date</label>
                    <input asp-for="TestDate" runat="server" type="text" tabindex="-1" class="form-control" id="testDateInput" readonly style="background-color: #e9ecef; cursor: not-allowed;" />
                <span asp-validation-for="TestDate" class="text-danger"></span>
                </div>
            </div>
        </div>
      @*   <div class="form-row">
            <div class="col-md-6">
              <div class="form-group"> <label asp-for="EstablishmentName">Establishment Name</label> 
                <input runat="server" id="EstablishmentName" tabindex="1" name="EstablishmentName" asp-for="EstablishmentName" class="form-control" type="text" />
                <span asp-validation-for="EstablishmentName" class="text-danger"></span>
                  </div>
            </div>
            <div class="col-md-6">
            <div class="form-group"><label asp-for="Designation">Designation</label>
                    <input asp-for="Designation" runat="server" type="text" value="" tabindex="2" class="form-control" id="datetimepicker" />
                    <span asp-validation-for="Designation" class="text-danger"></span>
                </div>
            </div>
        </div> *@

        @* <div class="form-row">
           
        </div>
         *@
        <div>
            <hr />
        </div>
        <div>
            <table class="table table-striped table-bordered" width="600" border="0" cellspacing="0" cellpadding="0">
                <thead style="background: #002060; color: #fff">
                    <tr>
                        <th class="col-xs-1">Sno</th>
                        <th class="col-xs-6">Critical Performance Steps</th>
                        <th class="col-xs-4">Points</th>
                    </tr>
                </thead>
                <tr style="display: none">
                    <td>Name</td>
                    <td>
                        An Establishment shall not use a name which is substantially
                        the same as the name of another ambulance service licensed by
                        DCAS unless the applicant is part of the same organization or
                        affiliated organization of the other services.
                    </td>
                    <td>
                        <input runat="server" type="checkbox" name="StandardName" id="StandardName" value="Yes" />
                        <label for="StandardName"></label>
                    </td>
                    <td>
                        <textarea runat="server" class="textAreaBig form-control" name="txtCmts" tabindex="6" id="txtRemarks1"
                                  rows="3" cols="10"></textarea>
                    </td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>Checks for response</td>
                    <td>
                        <input type="checkbox" asp-for="PointsStep1" />
                        <span asp-validation-for="PointsStep1" class="text-danger"></span>
                    </td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>
                        Checks breathing. Scans the chest (minimum 5 seconds, maximum
                        10 seconds)
                    </td>
                    <td>
                        <input type="checkbox" asp-for="PointsStep2" />
                        <span asp-validation-for="PointsStep2" class="text-danger"></span>
                    </td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>Activate emergency response system. Calls for AED.</td>

                    <td>
                        <input type="checkbox" asp-for="PointsStep3" />
                        <span asp-validation-for="PointsStep3" class="text-danger"></span>
                    </td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>
                        Checks for pulse (minimum 5 seconds, maximum 10 seconds)
                    </td>
                    <td>
                        <input type="checkbox" asp-for="PointsStep4" />
                        <span asp-validation-for="PointsStep4" class="text-danger"></span>
                    </td>
                </tr>

                <tr>
                    <td>5</td>
                    <td>Locates CPR hand position</td>
                    <td>
                        <input type="checkbox" asp-for="PointsStep5" />
                        <span asp-validation-for="PointsStep5" class="text-danger"></span>
                    </td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>Delivers 1st cycle of compression at correct rate</td>
                    <td>
                        <input type="checkbox" asp-for="PointsStep6" />
                        <span asp-validation-for="PointsStep6" class="text-danger"></span>
                    </td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>Gives 2 breaths (1 second each)</td>
                    <td>
                        <input type="checkbox" asp-for="PointsStep7" />
                        <span asp-validation-for="PointsStep7" class="text-danger"></span>
                    </td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>
                        Delivers 2nd cycle of compression at correct hand position
                    </td>
                    <td>
                        <input type="checkbox" asp-for="PointsStep8" />
                        <span asp-validation-for="PointsStep8" class="text-danger"></span>
                    </td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>Gives 2 breaths (1 second each)</td>
                    <td>
                        <input type="checkbox" asp-for="PointsStep9" />
                        <span asp-validation-for="PointsStep9" class="text-danger"></span>
                    </td>
                </tr>
                <tr>
                    <th rowspan="2" style="background: #c00000; color: #fff">10</th>
                    <td style="background: #002060; color: #fff">
                        The next step is done only with a manikin with feedback
                        device, such as a clicker. If no feedback, STOP the test.
                    </td>
                </tr>
                <tr>
                    <td>
                        Delivers 3rd cycle of compressions of adequate depth with full
                        chest recoil.
                    </td>
                    <th rowspan="2">
                        <input type="checkbox" asp-for="PointsStep10" />
                        <span asp-validation-for="PointsStep10" class="text-danger"></span>
                    </th>
                </tr>
            </table>
        </div>
        <div>
            <hr />
        </div>
        
        <table width="100%" class="table table-striped table-hover">
            <input type="hidden" id="selectedRadio" asp-for="Result" />
            <tr>
                <td class="col-6">
                    <label>Result</label>
                </td>
                <td class="col-1">
                    <label>Pass</label>
                </td>
                <td class="col-2">

                    <input style="display: block; margin: 0 auto" class="form-check-input" type="radio"
                           name="RadioDefault" value="Pass" id="myradio" checked />
                </td>
                <td class="col-1">
                    <label>Fail</label>
                </td>
                <td class="col-2">
                    <input style="display: block; margin: 0 auto" class="form-check-input" type="radio"
                           name="RadioDefault" value="Fail" id="myradio" checked />
                </td>
            </tr>
        </table>
        <table class="table table-striped table-bordered" width="600" border="0" cellspacing="0" cellpadding="0">
                    <thead style="background: #002060; color: #fff; text-align: center">
                        <tr>
                            <th class="col-8">Comments</th>
                        </tr>
                    </thead>
                    <tr>
                        <td>
                            <textarea runat="server" class="textAreaBig form-control" asp-for="Comments" name="Comments" tabindex="6" id="txtRemarks1"
                                      rows="3" cols="10"></textarea>
                        </td>
                    </tr>
                </table>
                <div style="text-align: right; margin-top: 10px" class="row">
                        <div class="text_area col-6">
                            <div>
                                <label asp-for="Assessor1">Name Of Assesor 1</label>
                                <div class="clear_area"></div>
                                <select asp-for="Assessor1" class="form-control">
                                    <option value="" selected="selected">Select Assessor</option>
                                    <option value="Zulfiya Hakim Mirza">Zulfiya Hakim Mirza</option>
                                    <option value="Sudhakar Philpdhas">Sudhakar Philpdhas</option>
                                    <option value="Nawal Murad Al Balooshi">Nawal Murad Al Balooshi</option>
                                    <option value="Mona Othman Abdul Qader">Mona Othman Abdul Qader</option>
                                    <option value="Khaled Jamshid Rahravan">Khaled Jamshid Rahravan</option>
                                    <option value="Saeeda Buti Saeed">Saeeda Buti Saeed</option>
                                </select>
                            </div>
                            <div class="clear_area"></div>
                            <div class="panel panel-default">
                                <div class="panel-body" id="signature-pad">
                                    <div>
                                        <canvas id="sigcanvas" style="
                        width: 90%;
                        height: 200px;
                        border: 1px ridge #ccc;
                        border-radius: 5px 5px 10px 15px;
                      "></canvas>
                                     
                                        <input type="hidden" ID="ImageValInspector1" name="Assessor1Sign" />
                                        <span id="Assessor1SignError" class="text-danger"></span>
                                    </div>
                                    <div>
                                        <button data-action="clear" class="btn btn-danger">
                                            Clear
                                        </button>
                                        <button style="display: none" data-action="save" class="btn btn-success">
                                            تقديـــم
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text_area col-6">
                            <div>
                                <label asp-for="Assessor2">Name Of Assesor 2</label>
                                <div class="clear_area"></div>
                                <select asp-for="Assessor2" class="form-control">
                                    <option value="" selected="selected">Select Assessor</option>
                                    <option value="Zulfiya Hakim Mirza">Zulfiya Hakim Mirza</option>
                                    <option value="Sudhakar Philpdhas">Sudhakar Philpdhas</option>
                                    <option value="Nawal Murad Al Balooshi">Nawal Murad Al Balooshi</option>
                                    <option value="Mona Othman Abdul Qader">Mona Othman Abdul Qader</option>
                                    <option value="Khaled Jamshid Rahravan">Khaled Jamshid Rahravan</option>
                                    <option value="Saeeda Buti Saeed">Saeeda Buti Saeed</option>
                                </select>
                            </div>
                            <div class="clear_area"></div>
                            <div class="panel panel-default">
                                <div class="panel-body" id="signature-padCustomer">
                                    <div>
                                        <canvas id="canvasCustomer" style="
                        width: 90%;
                        height: 200px;
                        border: 1px ridge #ccc;
                        border-radius: 5px 5px 10px 15px;
                      "></canvas>
                                        <input type="hidden" ID="ImageValCustomer" name="Assessor2Sign" />
                                        <span id="Assessor2SignError" class="text-danger"></span>
                                    </div>
                                    <div class="mx-auto">
                                        <button data-action="clearCustomer" class="btn btn-danger">
                                            Clear
                                        </button>
                                        <button style="display: none" data-action="save" class="btn btn-success">
                                            تقديـــم
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                
               
                <div style="display: none" class="noteBottom img-rounded">
                    Official use only:
                    <br />
                    Report received by and date:<br />
                    Scanned and filed<br />
                </div>
                <div class="mt-4">
                    <button id="saveForm" style="display: block; margin: 0 auto" runat="server" Text="Submit"
                            class="btn btn-primary">
                        Submit
                    </button>
                </div>

       </div>
</form>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/js/signature_pad.js"></script>
<script type="text/javascript">
    $(function () {
        const today = new Date();
        const formattedDate = today.getDate().toString().padStart(2, '0') + '-' +
            (today.getMonth() + 1).toString().padStart(2, '0') + '-' +
            today.getFullYear();
        $("#testDateInput").val(formattedDate);

        $("#saveForm").bind("click", function (e) {
            let valid = true;
            if (signaturePad.isEmpty()) {
                $("[Id*=ImageValInspector1]").val("_blank");
                $("#Assessor1SignError").text("Signature of Assessor 1 is required."); // 🔸 Show error
                valid = false;
            } else {
                var base64 = $("#sigcanvas")[0].toDataURL();
                base64 = base64.replace("data:image/png;base64,", "");
                $("[Id*=ImageValInspector1]").val(base64);
                $("#Assessor1SignError").text("");
                //window.alert($("#ImageValInspector1").val());
            }

            if (signaturePadCustomer.isEmpty()) {
                $("[Id*=ImageValCustomer]").val("_blank");
                $("#Assessor2SignError").text("Signature of Assessor 2 is required."); // 🔸 Show error
                valid = false;
            } else {
                var base64C = $("#canvasCustomer")[0].toDataURL();
                base64C = base64C.replace("data:image/png;base64,", "");
                $("[Id*=ImageValCustomer]").val(base64C);
                $("#Assessor2SignError").text("");
            }

            var my2ndopt = $('input[name="RadioDefault"]:checked').val(); // Q10 Rating
            //window.alert(my2ndopt);

            $("#selectedRadio").val(my2ndopt);
            if (!valid) {
                e.preventDefault(); 
            }
        });
    });
</script>
<script lang="ja" type="text/javascript">
    var wrapper = document.getElementById("signature-pad"),
        clearButton = wrapper.querySelector("[data-action=clear]"),
        canvas = wrapper.querySelector("canvas"),
        signaturePad;

    var wrapperCustomer = document.getElementById("signature-padCustomer"),
        clearButtonCustomer = wrapperCustomer.querySelector(
            "[data-action=clearCustomer]"
        ),
        canvasCustomer = wrapperCustomer.querySelector("canvas"),
        signaturePadCustomer;

    function resizeCanvas() {
        var ratio = window.devicePixelRatio || 1;
        canvas.width = canvas.offsetWidth * ratio;
        canvas.height = canvas.offsetHeight * ratio;
        canvas.getContext("2d").scale(ratio, ratio);

        canvasCustomer.width = canvasCustomer.offsetWidth * ratio;
        canvasCustomer.height = canvasCustomer.offsetHeight * ratio;
        canvasCustomer.getContext("2d").scale(ratio, ratio);
    }

    window.onresize = resizeCanvas;
    resizeCanvas();
    signaturePad = new SignaturePad(canvas);
    var el = document.getElementById("clear");
    if (el) {
        clearButtonCustomer.addEventListener("click", function (event) {
            signaturePad.clear();
        });
    }

    var el2 = document.getElementById("clearCustomer");
    signaturePadCustomer = new SignaturePad(canvasCustomer);
    if (el2) {
        clearButtonCustomer.addEventListener("click", function (event) {
            signaturePadCustomer.clear();
        });
    }

    var uri = "api/signatures";
</script>
